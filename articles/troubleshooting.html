<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Troubleshooting • didehpc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Troubleshooting">
<meta property="og:description" content="didehpc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">didehpc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/didehpc.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Package installation</a>
    </li>
    <li>
      <a href="../articles/quickstart.html">Quickstart for R and the DIDE cluster</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/workers.html">Workers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/didehpc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="troubleshooting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Troubleshooting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/didehpc/blob/master/vignettes/troubleshooting.Rmd"><code>vignettes/troubleshooting.Rmd</code></a></small>
      <div class="hidden name"><code>troubleshooting.Rmd</code></div>

    </div>

    
    
<!-- DO NOT EDIT THIS FILE - see vignettes_src and make changes there -->
<p>Base queue object:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctx</span> <span class="op">&lt;-</span> <span class="fu">context</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/context/man/context_save.html">context_save</a></span><span class="op">(</span><span class="st">"contexts"</span><span class="op">)</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ save:id   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ save:name ]  discretionary_stingray</span>
<span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/queue_didehpc.html">queue_didehpc</a></span><span class="op">(</span><span class="va">ctx</span><span class="op">)</span>
<span class="co">#&gt; Loading context 81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]</span></code></pre></div>
<div id="my-job-has-failed" class="section level1">
<h1 class="hasAnchor">
<a href="#my-job-has-failed" class="anchor"></a>My job has failed</h1>
<div id="my-job-status-is-error" class="section level2">
<h2 class="hasAnchor">
<a href="#my-job-status-is-error" class="anchor"></a>My job status is <code>ERROR</code>
</h2>
<div id="caused-by-an-error-in-your-code" class="section level3">
<h3 class="hasAnchor">
<a href="#caused-by-an-error-in-your-code" class="anchor"></a>Caused by an error in your code</h3>
<p>If your job status is <code>ERROR</code> that <em>probably</em> indicates an error in your code. There are lots of reasons that this could be for, and the first challenge is working out what happened.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu">mysimulation</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; (-) waiting for f416387...bac, giving up in 9.5 s (\) waiting for f416387...bac,
#&gt; giving up in 9.0 s</code></pre>
<p>This job will fail, and <code>$status()</code> will report <code>ERROR</code></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "ERROR"</span></code></pre></div>
<p>The first place to look is the result of the job itself. Unlike an error in your console, an error that happens on the cluster can be returned and inspected:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; &lt;context_task_error in mysimulation(10): could not find function "mysimulation"&gt;</span></code></pre></div>
<p>In this case the error is because the function <code>mysimulation</code> does not exist.</p>
<p>The other place worth looking is the job log</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">log</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [ hello     ]  2021-08-17 14:53:09</span>
<span class="co">#&gt; [ wd        ]  Q:/didehpc/20210817-145020</span>
<span class="co">#&gt; [ init      ]  2021-08-17 14:53:09.042</span>
<span class="co">#&gt; [ hostname  ]  FI--DIDECLUST26</span>
<span class="co">#&gt; [ process   ]  3672</span>
<span class="co">#&gt; [ version   ]  0.3.0</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]</span>
<span class="co">#&gt; [ parallel  ]  running as single core job</span>
<span class="co">#&gt; [ root      ]  Q:\didehpc\20210817-145020\contexts</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ task      ]  f4163877615d5f6fa6fb6392b6739bac</span>
<span class="co">#&gt; [ expr      ]  mysimulation(10)</span>
<span class="co">#&gt; [ start     ]  2021-08-17 14:53:09.199</span>
<span class="co">#&gt; [ error     ]</span>
<span class="co">#&gt;     Error in mysimulation(10): could not find function "mysimulation"</span>
<span class="co">#&gt; [ end       ]  2021-08-17 14:53:09.308</span>
<span class="co">#&gt;     Error in context:::main_task_run() : Error while running task:</span>
<span class="co">#&gt;     Execution halted</span></code></pre></div>
<p>Sometimes there will be additional diagnostic information there.</p>
<p>Here’s another example:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"c:/myfile.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>#&gt; (-) waiting for 9df1d9f...c74, giving up in 9.5 s (\) waiting for 9df1d9f...c74,
#&gt; giving up in 9.0 s</code></pre>
<p>This job will fail, and <code>$status()</code> will report <code>ERROR</code></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "ERROR"</span></code></pre></div>
<p>Here is the error, which is a bit less informative this time:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; &lt;context_task_error in file(file, "rt"): cannot open the connection&gt;</span></code></pre></div>
<p>The log gives a better idea of what is going on - the file <code>c:/myfile.csv</code> does not exist (because it is not found on the cluster; using relative paths is much preferred to absolute paths)</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">log</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [ hello     ]  2021-08-17 14:53:10</span>
<span class="co">#&gt; [ wd        ]  Q:/didehpc/20210817-145020</span>
<span class="co">#&gt; [ init      ]  2021-08-17 14:53:10.777</span>
<span class="co">#&gt; [ hostname  ]  FI--DIDECLUST26</span>
<span class="co">#&gt; [ process   ]  2000</span>
<span class="co">#&gt; [ version   ]  0.3.0</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]</span>
<span class="co">#&gt; [ parallel  ]  running as single core job</span>
<span class="co">#&gt; [ root      ]  Q:\didehpc\20210817-145020\contexts</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ task      ]  9df1d9f60717796422e1e62c8e206c74</span>
<span class="co">#&gt; [ expr      ]  read.csv("c:/myfile.csv")</span>
<span class="co">#&gt; [ start     ]  2021-08-17 14:53:10.949</span>
<span class="co">#&gt; [ error     ]</span>
<span class="co">#&gt;     Error in file(file, "rt"): cannot open the connection</span>
<span class="co">#&gt; [ end       ]  2021-08-17 14:53:11.074</span>
<span class="co">#&gt;     Error in context:::main_task_run() : Error while running task:</span>
<span class="co">#&gt;     In addition: Warning message:</span>
<span class="co">#&gt;     In file(file, "rt") :</span>
<span class="co">#&gt;       cannot open file 'c:/myfile.csv': No such file or directory</span>
<span class="co">#&gt;     Execution halted</span></code></pre></div>
<p>The real content of the error message is present in the warning! You can also get the warnings with</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">warnings</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; &lt;simpleWarning in file(file, "rt"): cannot open file 'c:/myfile.csv': No such file or directory&gt;</span></code></pre></div>
<p>Which will be a list of all warnings generated during the execution of your task (even if it succeeds). The traceback also shows what happened:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">trace</span>
<span class="co">#&gt;  [1] "context:::main_task_run()"</span>
<span class="co">#&gt;  [2] "task_run(task_id, ctx)"</span>
<span class="co">#&gt;  [3] "eval_safely(dat$expr, dat$envir, \"context_task_error\", 3)"</span>
<span class="co">#&gt;  [4] "tryCatch(withCallingHandlers(eval(expr, envir), warning = function(e) warni"</span>
<span class="co">#&gt;  [5] "tryCatchList(expr, classes, parentenv, handlers)"</span>
<span class="co">#&gt;  [6] "tryCatchOne(expr, names, parentenv, handlers[[1]])"</span>
<span class="co">#&gt;  [7] "doTryCatch(return(expr), name, parentenv, handler)"</span>
<span class="co">#&gt;  [8] "withCallingHandlers(eval(expr, envir), warning = function(e) warnings$add(e"</span>
<span class="co">#&gt;  [9] "eval(expr, envir)"</span>
<span class="co">#&gt; [10] "eval(expr, envir)"</span>
<span class="co">#&gt; [11] "read.csv(\"c:/myfile.csv\")"</span>
<span class="co">#&gt; [12] "read.table(file = file, header = header, sep = sep, quote = quote, dec = de"</span>
<span class="co">#&gt; [13] "file(file, \"rt\")"</span></code></pre></div>
</div>
<div id="caused-by-an-error-during-startup" class="section level3">
<h3 class="hasAnchor">
<a href="#caused-by-an-error-during-startup" class="anchor"></a>Caused by an error during startup</h3>
<p>These are harder to troubleshoot but we can still pull some information out. The example here was a real-world case and illustrates one of the issues with using a shared filesystem in the way that we do here.</p>
<p>Suppose you have a context that uses some code in <code>mycode.R</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">times2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span>
<span class="op">}</span></code></pre></div>
<p>You create a connection to the cluster:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctx</span> <span class="op">&lt;-</span> <span class="fu">context</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/context/man/context_save.html">context_save</a></span><span class="op">(</span><span class="st">"contexts"</span>, sources <span class="op">=</span> <span class="st">"mycode.R"</span><span class="op">)</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ save:id   ]  dd8c63ce681e6586c8e4fd8c1b5f6925</span>
<span class="co">#&gt; [ save:name ]  fuzzy_bass</span>
<span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/queue_didehpc.html">queue_didehpc</a></span><span class="op">(</span><span class="va">ctx</span><span class="op">)</span>
<span class="co">#&gt; Loading context dd8c63ce681e6586c8e4fd8c1b5f6925</span>
<span class="co">#&gt; [ context   ]  dd8c63ce681e6586c8e4fd8c1b5f6925</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]  mycode.R</span></code></pre></div>
<p>Everything seems to work fine:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu">times2</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">t</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; (-) waiting for d478d26...d70, giving up in 9.5 s (\) waiting for d478d26...d70,</span>
<span class="co">#&gt; giving up in 9.0 s</span>
<span class="co">#&gt; [1] 20</span></code></pre></div>
<p>…but then you’re editing the file and save the file but it is not syntactically correct:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>times2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="dv">2</span> <span class="op">*</span><span class="st"> </span>x</span>
<span id="cb17-3"><a href="#cb17-3"></a>}</span>
<span id="cb17-4"><a href="#cb17-4"></a>newfun &lt;-<span class="st"> </span><span class="cf">function</span>(x)</span></code></pre></div>
<p>And then you either submit a job, <strong>or</strong> a job that you have previously submitted gets run (which could happen ages after you submit it if the cluster is busy).</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu">times2</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">t</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; (-) waiting for ef79e3b...390, giving up in 9.5 s (\) waiting for ef79e3b...390,</span>
<span class="co">#&gt; giving up in 9.0 s</span>
<span class="co">#&gt; &lt;context_task_error in source(s, envir): mycode.R:5:0: unexpected end of input</span>
<span class="co">#&gt; 3: }</span>
<span class="co">#&gt; 4: newfun &lt;- function(x)</span>
<span class="co">#&gt;   ^&gt;</span>
<span class="va">t</span><span class="op">$</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "ERROR"</span></code></pre></div>
<p>The error here has happened before getting to your code - it is happening when context loads the source files. The log makes this a bit clearer:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">log</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [ hello     ]  2021-08-17 14:53:14</span>
<span class="co">#&gt; [ wd        ]  Q:/didehpc/20210817-145020</span>
<span class="co">#&gt; [ init      ]  2021-08-17 14:53:14.324</span>
<span class="co">#&gt; [ hostname  ]  FI--DIDECLUST26</span>
<span class="co">#&gt; [ process   ]  3528</span>
<span class="co">#&gt; [ version   ]  0.3.0</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ context   ]  dd8c63ce681e6586c8e4fd8c1b5f6925</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]  mycode.R</span>
<span class="co">#&gt;     Error in source(s, envir) : mycode.R:5:0: unexpected end of input</span>
<span class="co">#&gt;     3: }</span>
<span class="co">#&gt;     4: newfun &lt;- function(x)</span>
<span class="co">#&gt;       ^</span>
<span class="co">#&gt;     Calls: &lt;Anonymous&gt; -&gt; withCallingHandlers -&gt; context_load -&gt; source</span>
<span class="co">#&gt;     Execution halted</span></code></pre></div>
</div>
<div id="my-jobs-are-getting-stuck-at-pending" class="section level3">
<h3 class="hasAnchor">
<a href="#my-jobs-are-getting-stuck-at-pending" class="anchor"></a>My jobs are getting stuck at <code>PENDING</code>
</h3>
<p>This is the most annoying one, and can happen for many reasons. You can see via the <a href="mrcdata.dide.ic.ac.uk/hpc/">web interface</a> or the Microsoft cluster tools that your job has failed but <code>didehpc</code> is reporting it as pending. This happens when something has failed during the script that runs <em>before</em> any <code>didehpc</code> code runs on the cluster.</p>
<p>Things that have triggered this situation in the past:</p>
<ul>
<li>An error in the Microsoft cluster tools</li>
<li>A misconfigured node (sometimes they are missing particular software)</li>
<li>A networking issue</li>
<li>Gremlins</li>
<li>Network path mapping error</li>
</ul>
<p>There are doubtless others. Here, I’ll simulate one so you can see how to troubleshoot it. I’m going to <em>deliberately</em> misconfigure the network share that this is running on so that the cluster will not be able to map it and the job will fail to start</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">home</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/path_mapping.html">path_mapping</a></span><span class="op">(</span><span class="st">"home"</span>, <span class="fu"><a href="https://rdrr.io/r/base/getwd.html">getwd</a></span><span class="op">(</span><span class="op">)</span>,
                              <span class="st">"//fi--wronghost/path"</span>, <span class="st">"Q:"</span><span class="op">)</span></code></pre></div>
<p>The host <code>fi--wronghost</code> does not exist so things will likely fail on startup.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">config</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/didehpc_config.html">didehpc_config</a></span><span class="op">(</span>home <span class="op">=</span> <span class="va">home</span><span class="op">)</span>
<span class="va">ctx</span> <span class="op">&lt;-</span> <span class="fu">context</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/context/man/context_save.html">context_save</a></span><span class="op">(</span><span class="st">"contexts"</span><span class="op">)</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/queue_didehpc.html">queue_didehpc</a></span><span class="op">(</span><span class="va">ctx</span>, <span class="va">config</span><span class="op">)</span>
<span class="co">#&gt; Loading context 81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ context   ]  81b64478fe2182e45e83fec2156c6ec7</span>
<span class="co">#&gt; [ library   ]</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]</span></code></pre></div>
<p>Submit a job:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>And wait…</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; (-) waiting for 36dece3...711, giving up in 9.5 s (\) waiting for 36dece3...711,</span>
<span class="co">#&gt; giving up in 9.0 s (|) waiting for 36dece3...711, giving up in 8.5 s (/) waiting</span>
<span class="co">#&gt; for 36dece3...711, giving up in 8.0 s (-) waiting for 36dece3...711, giving</span>
<span class="co">#&gt; up in 7.5 s (\) waiting for 36dece3...711, giving up in 7.0 s (|) waiting for</span>
<span class="co">#&gt; 36dece3...711, giving up in 6.4 s (/) waiting for 36dece3...711, giving up</span>
<span class="co">#&gt; in 5.9 s (-) waiting for 36dece3...711, giving up in 5.4 s (\) waiting for</span>
<span class="co">#&gt; 36dece3...711, giving up in 4.9 s (|) waiting for 36dece3...711, giving up</span>
<span class="co">#&gt; in 4.4 s (/) waiting for 36dece3...711, giving up in 3.9 s (-) waiting for</span>
<span class="co">#&gt; 36dece3...711, giving up in 3.4 s (\) waiting for 36dece3...711, giving up</span>
<span class="co">#&gt; in 2.9 s (|) waiting for 36dece3...711, giving up in 2.4 s (/) waiting for</span>
<span class="co">#&gt; 36dece3...711, giving up in 1.9 s (-) waiting for 36dece3...711, giving up</span>
<span class="co">#&gt; in 1.4 s (\) waiting for 36dece3...711, giving up in 0.9 s (|) waiting for</span>
<span class="co">#&gt; 36dece3...711, giving up in 0.3 s (/) waiting for 36dece3...711, giving up in</span>
<span class="co">#&gt; 0.0 s</span>
<span class="co">#&gt; Error in task_wait(self$root$db, self$id, timeout, time_poll, progress): task not returned in time</span></code></pre></div>
<p>It’s never going to succeed and yet it’s status will stay as <code>PENDING</code>:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "PENDING"</span></code></pre></div>
<p>To get the log from the DIDE cluster you can run:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">$</span><span class="fu">dide_log</span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
<span class="co">#&gt; [1] "Task failed during execution with exit code . Please check task's output for error details."</span>
<span class="co">#&gt; [2] "Output                          : The network path was not found."</span></code></pre></div>
<p>which here indicates that the network path was not found (because it was wrong!)</p>
<p>You can also update any incorrect statuses by running:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">$</span><span class="fu">reconcile</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Fetching job status from the cluster...</span>
<span class="co">#&gt;   ...done</span>
<span class="co">#&gt; manually erroring task 36dece32d6c38f71464ed1fd9a9be711</span>
<span class="co">#&gt; Tasks have failed while context booting:</span>
<span class="co">#&gt;   - 36dece32d6c38f71464ed1fd9a9be711</span></code></pre></div>
<p>Which will print information about anything that was adjusted.</p>
</div>
</div>
<div id="my-job-works-on-my-computer-but-not-on-the-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#my-job-works-on-my-computer-but-not-on-the-cluster" class="anchor"></a>My job works on my computer but not on the cluster</h2>
<p>In that case, something is different between how the cluster sees the world, and how your computer sees it.</p>
<ul>
<li>Look in the logs to try and find the reason why the failing jobs are doing so.</li>
<li>Are there variables in the global R environment on your local computer, that your code relies upon, that won’t be present on the cluster? Do you have local R packages or sources loaded which you haven’t declared when initialising your context?</li>
<li>Or any system variables, or other dependencies which enable your job to work locally, but won’t be set up on a cluster node?</li>
<li>Are you referring to any files visible to your local machine, but not on the cluster? Are you referring to <code>C:</code> for instance?</li>
<li>(Rarely:) Are you viewing a cached version of any network storage on your local computer, that has not been synced to the real network storage view that the cluster has?</li>
<li>Check that you have not run out of disk-space. The Q: quota is normally 15Gb.</li>
<li>If you are running C code, check for other causes of indeterminate failures, such as uninitialised variables, or array out-of-bounds errors. These are unpredictable errors by nature, but surprisingly often you might get away with it on a local computer, while a cluster node behaves differently.</li>
<li>If you are running stochastic code, check that you are <em>really</em> using the same random number seeds.</li>
</ul>
</div>
<div id="some-of-my-jobs-work-on-the-cluster-but-others-fail-" class="section level2">
<h2 class="hasAnchor">
<a href="#some-of-my-jobs-work-on-the-cluster-but-others-fail-" class="anchor"></a>Some of my jobs work on the cluster, but others fail.</h2>
<ul>
<li>Look in the logs to try and find the reason why the failing jobs do so.</li>
<li>Try rerunning the failed jobs. Is it the same set that passes, and the same set that fails? In that case, consider what makes your jobs different - perhaps job-specific input data or parameters could cause the failures.</li>
<li>If you find messages about “Error allocating a vector…” or “std::bad_alloc”, then try and work out the memory usage of a single job. Perhaps run it locally with task manager (windows), or <code>top</code> (linux) running, and watch to see what the memory usage is. If the job is single-core, consider the total memory used if you run 8 or 16 instances on the same cluster machine. If the total memory exceeds the available, then behaviour will be undefined, and some jobs will likely fail.</li>
<li>In the above example, note that someone else’s memory-hungry combination of jobs may affect your small-memory job, if they run on the same node. We don’t enforce any memory limits on jobs, which on the whole, is nice and convenient, but it carries the risk that the above can happen.</li>
<li>Always check you’re not running out disk space. The Q: quota is normally 15Gb.</li>
<li>Find what node your jobs were running on. If you consistently get errors on one node, but not others, then get in touch with Wes, as we do get node failures from time to time, where the fault is not obvious at first.</li>
</ul>
</div>
<div id="my-job-is-slower-on-the-cluster-than-running-locally" class="section level2">
<h2 class="hasAnchor">
<a href="#my-job-is-slower-on-the-cluster-than-running-locally" class="anchor"></a>My job is slower on the cluster than running locally!</h2>
<ul>
<li>This is expected, especially for single-core jobs. Cluster nodes are aiming to provide bandwidth, rather than linear performance, so a single job may run slower on a cluster node than on your own computer. But the cluster node might be able to run 8 or more such jobs at once, without taking any longer, while you continue using your local computer for local things.</li>
<li>If that is still insufficient, and you still want to compare timings in this way, then check that the cluster is doing <em>exactly</em> the same work as your local computer.</li>
</ul>
</div>
<div id="asking-for-help" class="section level2">
<h2 class="hasAnchor">
<a href="#asking-for-help" class="anchor"></a>Asking for help</h2>
<p>If you need help, you can ask in the “Cluster” teams channel or try your luck emailing Rich and Wes (they may or may not have time to respond, or may be on leave).</p>
<p>When asking for help it is really important that you make it as easy as possible for us to help you. This is surprisingly hard to do well, and we would ask that you first take a look at these two short articles:</p>
<ul>
<li><a href="https://stackoverflow.com/help/how-to-ask">How to ask a good question</a></li>
<li><a href="https://stackoverflow.com/help/minimal-reproducible-example">How to create a minimal, reproducible example</a></li>
</ul>
<p>Things we will need to know:</p>
<ul>
<li>Your DIDE username (as this makes seeing job statuses much easier)</li>
<li>Minimally, which cluster you are using but better to post your entire didehpc config (<code>obj$config</code> if you have managed to create an object)</li>
<li>What you’ve tried doing</li>
<li>The values of any errors (not just that they occurred!)</li>
<li>Logs of the offending job if you have it</li>
</ul>
<p>Too often, we will get requests from people that where we have no information about what was run, what packages or versions are being installed, etc. This means your message sits there until we see it, we’ll ask for clarification - that message sits there until you see it, you respond with a little more information, and it may be days until we finally discover the root cause of your problem, by which point we’re both quite fed up. We will never complain if you provide “too much” information in a good effort to outline where your problem is.</p>
<p><strong>Don’t say</strong></p>
<blockquote>
<p>Hi, I was running a cluster job, but it seems like it failed. I’m sure it worked the other day though! Do you know what the problem is?</p>
</blockquote>
<p><strong>Do say</strong></p>
<blockquote>
<p>Since yesterday, my cluster job has stopped working.</p>
<p>My dide username is <code>alicebobson</code> and my dide config is:</p>
<pre><code>&lt;didehpc_config&gt;
 - cluster: fi--dideclusthn
 - username: rfitzjoh
 (etc)</code></pre>
<p>I am working on the <code>myproject</code> directory of the malaria share (<code>\\projects\malaria</code>)</p>
<p>I have set up my cluster job with</p>
<pre><code># include short script here if you can!</code></pre>
<p>The job <code>43333cbd79ccbf9ede79556b592473c8</code> is one that failed with an error, and the log says</p>
<pre><code># contents of t$log() here</code></pre>
</blockquote>
<p>with this sort of information the problem may just jump out at us, or we may be able to create the error ourselves - either way we may be able to work on the problem and get back to you with a solution rather than a request for more information.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
