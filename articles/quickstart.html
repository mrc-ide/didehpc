<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quickstart for R and the DIDE cluster • didehpc</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quickstart for R and the DIDE cluster">
<meta property="og:description" content="didehpc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">didehpc</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.10</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/didehpc.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/orderly.html">Using didehpc to run orderly tasks</a>
    </li>
    <li>
      <a href="../articles/packages.html">Package installation</a>
    </li>
    <li>
      <a href="../articles/quickstart.html">Quickstart for R and the DIDE cluster</a>
    </li>
    <li>
      <a href="../articles/troubleshooting.html">Troubleshooting</a>
    </li>
    <li>
      <a href="../articles/workers.html">Workers</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mrc-ide/didehpc/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="quickstart_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quickstart for R and the DIDE cluster</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/didehpc/blob/master/vignettes/quickstart.Rmd"><code>vignettes/quickstart.Rmd</code></a></small>
      <div class="hidden name"><code>quickstart.Rmd</code></div>

    </div>

    
    
<!-- DO NOT EDIT THIS FILE - see vignettes_src and make changes there -->
<blockquote>
<p>Get yourself running R jobs on the cluster in 10 minutes or so.</p>
</blockquote>
<p>Assumptions that we make here:</p>
<ul>
<li><p>you are using R</p></li>
<li><p>your task can be represented as running a function on some inputs to create an output (a file based output is OK)</p></li>
<li><p>you are working on a network share and have this mounted on your computer</p></li>
<li><p>you know what packages your code depends on</p></li>
<li><p>your package dependencies are all on CRAN, and are all available in windows binary form.</p></li>
</ul>
<p>If any of these do not apply to you, you’ll probably need to read the full vignette. In any case the full vignette contains a bunch more information anyway.</p>
<div id="install-a-lot-of-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#install-a-lot-of-packages" class="anchor"></a>Install a lot of packages</h2>
<p>Install the packages using <a href="https://cran.rstudio.com/package=drat"><code>drat</code></a></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install.package("drat") # if you don't have it already</span>
<span class="fu">drat</span><span class="fu">:::</span><span class="fu">add</span><span class="op">(</span><span class="st">"mrc-ide"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"didehpc"</span><span class="op">)</span></code></pre></div>
</div>
<div id="describe-your-computer-so-we-can-find-things" class="section level2">
<h2 class="hasAnchor">
<a href="#describe-your-computer-so-we-can-find-things" class="anchor"></a>Describe your computer so we can find things</h2>
<p>On windows if you are using a domain machine, you should need only to select the cluster you want to use</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>didehpc.cluster <span class="op">=</span> <span class="st">"fi--didemrchnb"</span><span class="op">)</span></code></pre></div>
<p>Otherwise, and on any other platform you’ll need to provide your username:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>didehpc.cluster <span class="op">=</span> <span class="st">"fi--didemrchnb"</span>,
        didehpc.username <span class="op">=</span> <span class="st">"yourusername"</span><span class="op">)</span></code></pre></div>
<p>You can see the default configuration with</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/didehpc_config.html">didehpc_config</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; &lt;didehpc_config&gt;</span>
<span class="co">#&gt;  - cluster: fi--dideclusthn</span>
<span class="co">#&gt;  - credentials:</span>
<span class="co">#&gt;     - username: rfitzjoh</span>
<span class="co">#&gt;     - password: *******************</span>
<span class="co">#&gt;  - username: rfitzjoh</span>
<span class="co">#&gt;  - resource:</span>
<span class="co">#&gt;     - template: GeneralNodes</span>
<span class="co">#&gt;     - parallel: FALSE</span>
<span class="co">#&gt;     - count: 1</span>
<span class="co">#&gt;     - type: Cores</span>
<span class="co">#&gt;  - shares:</span>
<span class="co">#&gt;     - home: (local) /home/rich/net/home =&gt; \\fi--san03.dide.ic.ac.uk\homes\rfitzjoh =&gt; Q: (remote)</span>
<span class="co">#&gt;     - temp: (local) /home/rich/net/temp =&gt; \\fi--didef3.dide.ic.ac.uk\tmp =&gt; T: (remote)</span>
<span class="co">#&gt;  - use_workers: FALSE</span>
<span class="co">#&gt;  - use_rrq: FALSE</span>
<span class="co">#&gt;  - worker_timeout: 600</span>
<span class="co">#&gt;  - conan_bootstrap: TRUE</span>
<span class="co">#&gt;  - r_version: 4.0.3</span>
<span class="co">#&gt;  - use_java: FALSE</span>
<span class="co">#&gt;  - redis_host: fi--dideclusthn.dide.ic.ac.uk</span></code></pre></div>
<p>If this is the first time you have run this package, best to try out the login procedure with:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/web_login.html">web_login</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>because this exposes a number of problems early on.</p>
</div>
<div id="describe-your-project-dependencies-so-we-can-recreate-that-on-the-cluster" class="section level2">
<h2 class="hasAnchor">
<a href="#describe-your-project-dependencies-so-we-can-recreate-that-on-the-cluster" class="anchor"></a>Describe your project dependencies so we can recreate that on the cluster</h2>
<p>Make a vector of packages that you use in your project:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">packages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dplyr"</span>, <span class="st">"tidyr"</span><span class="op">)</span></code></pre></div>
<p>And of files that define functions that you ned to run things:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sources</span> <span class="op">&lt;-</span> <span class="st">"mysources.R"</span></code></pre></div>
<p>If you had a vector here that would be OK too.</p>
<p>Then save this together to form a “context”.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ctx</span> <span class="op">&lt;-</span> <span class="fu">context</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/context/man/context_save.html">context_save</a></span><span class="op">(</span><span class="st">"contexts"</span>, packages <span class="op">=</span> <span class="va">packages</span>, sources <span class="op">=</span> <span class="va">sources</span><span class="op">)</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ save:id   ]  9a70cec48c3108b80503144f9b88cc8d</span>
<span class="co">#&gt; [ save:name ]  complexional_australiancurlew</span></code></pre></div>
<p>If you have no packages or no sources, use <code>NULL</code> or omit them in the call below (which is the default anyway).</p>
<p>The first argument here, <code>"contexts"</code> is the name of a directory that we will use to hold a lot of information about your jobs. You don’t need (or particularly want) to know what is in here.</p>
</div>
<div id="build-a-queue-based-on-this-context-" class="section level2">
<h2 class="hasAnchor">
<a href="#build-a-queue-based-on-this-context-" class="anchor"></a>Build a queue, based on this context.</h2>
<p>This will prompt you for your password, as it will try and log in.</p>
<p>It also installs windows versions of all packages within the <code>contexts</code> directory – both packages required to get this whole system working and then the packages required for your particular jobs.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">didehpc</span><span class="fu">::</span><span class="fu"><a href="../reference/queue_didehpc.html">queue_didehpc</a></span><span class="op">(</span><span class="va">ctx</span><span class="op">)</span>
<span class="co">#&gt; Loading context 9a70cec48c3108b80503144f9b88cc8d</span>
<span class="co">#&gt; [ context   ]  9a70cec48c3108b80503144f9b88cc8d</span>
<span class="co">#&gt; [ library   ]  dplyr, tidyr</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]  mysources.R</span>
<span class="co">#&gt; Running installation script on cluster</span>
<span class="co">#&gt;   ,:\      /:.</span>
<span class="co">#&gt;  //  \_()_/  \\</span>
<span class="co">#&gt; ||   |    |   ||  CONAN THE LIBRARIAN</span>
<span class="co">#&gt; ||   |    |   ||  Library:   Q:\didehpc\20210817-145020\contexts\lib\windows\4.0</span>
<span class="co">#&gt; ||   |____|   ||  Bootstrap: T:\conan\bootstrap\4.0</span>
<span class="co">#&gt;  \\  / || \  //   Cache:     Q:\didehpc\20210817-145020\contexts\conan\cache/pkg</span>
<span class="co">#&gt;   `:/  ||  \;'    Policy:    lazy</span>
<span class="co">#&gt;        ||         Repos:</span>
<span class="co">#&gt;        ||           * https://mrc-ide.github.io/didehpc-pkgs</span>
<span class="co">#&gt;        XX           * https://cloud.r-project.org</span>
<span class="co">#&gt;        XX         Packages:</span>
<span class="co">#&gt;        XX           * dplyr</span>
<span class="co">#&gt;        XX           * tidyr</span>
<span class="co">#&gt;        OO</span>
<span class="co">#&gt;        `'</span>
<span class="co">#&gt; i Loading metadata database</span>
<span class="co">#&gt; v Loading metadata database ... done</span>
<span class="co">#&gt; i Getting 17 pkgs (9.49 MB)</span>
<span class="co">#&gt; v Got ellipsis 0.3.2 (windows) (49.19 kB)</span>
<span class="co">#&gt; v Got generics 0.1.0 (windows) (70.74 kB)</span>
<span class="co">#&gt; v Got glue 1.4.2 (windows) (155.50 kB)</span>
<span class="co">#&gt; v Got lifecycle 1.0.0 (windows) (111.22 kB)</span>
<span class="co">#&gt; v Got fansi 0.5.0 (windows) (248.45 kB)</span>
<span class="co">#&gt; v Got cli 3.0.1 (windows) (758.73 kB)</span>
<span class="co">#&gt; v Got pkgconfig 2.0.3 (windows) (22.31 kB)</span>
<span class="co">#&gt; v Got magrittr 2.0.1 (windows) (234.90 kB)</span>
<span class="co">#&gt; v Got dplyr 1.0.7 (windows) (1.35 MB)</span>
<span class="co">#&gt; v Got purrr 0.3.4 (windows) (430.04 kB)</span>
<span class="co">#&gt; v Got tidyselect 1.1.1 (windows) (204.19 kB)</span>
<span class="co">#&gt; v Got tibble 3.1.3 (windows) (835.59 kB)</span>
<span class="co">#&gt; v Got utf8 1.2.2 (windows) (209.88 kB)</span>
<span class="co">#&gt; v Got rlang 0.4.11 (windows) (1.21 MB)</span>
<span class="co">#&gt; v Got vctrs 0.3.8 (windows) (1.25 MB)</span>
<span class="co">#&gt; v Got tidyr 1.1.3 (windows) (1.06 MB)</span>
<span class="co">#&gt; v Got pillar 1.6.2 (windows) (1.07 MB)</span>
<span class="co">#&gt; v Installed generics 0.1.0  (532ms)</span>
<span class="co">#&gt; v Installed cli 3.0.1  (1.3s)</span>
<span class="co">#&gt; v Installed ellipsis 0.3.2  (1.1s)</span>
<span class="co">#&gt; v Installed fansi 0.5.0  (1.3s)</span>
<span class="co">#&gt; v Installed glue 1.4.2  (1.4s)</span>
<span class="co">#&gt; v Installed lifecycle 1.0.0  (1.6s)</span>
<span class="co">#&gt; v Installed magrittr 2.0.1  (1.7s)</span>
<span class="co">#&gt; v Installed dplyr 1.0.7  (2.3s)</span>
<span class="co">#&gt; v Installed pkgconfig 2.0.3  (1.3s)</span>
<span class="co">#&gt; v Installed pillar 1.6.2  (1.8s)</span>
<span class="co">#&gt; v Installed purrr 0.3.4  (1.5s)</span>
<span class="co">#&gt; v Installed rlang 0.4.11  (1.4s)</span>
<span class="co">#&gt; v Installed tidyselect 1.1.1  (1.2s)</span>
<span class="co">#&gt; v Installed tibble 3.1.3  (1.6s)</span>
<span class="co">#&gt; v Installed utf8 1.2.2  (1.3s)</span>
<span class="co">#&gt; v Installed vctrs 0.3.8  (1.2s)</span>
<span class="co">#&gt; v Installed tidyr 1.1.3  (1.2s)</span>
<span class="co">#&gt; v Summary:   17 new   2 kept  in 23.7s</span>
<span class="co">#&gt; Done!</span></code></pre></div>
<p>Once you get to this point we’re ready to start running things on the cluster. Let’s fire off a test to make sure that everything works OK:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html">sessionInfo</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can poll the job for a while, which will print a progress bar. If the job is returned in time, it will return the result of running the function. Otherwise it will throw an error.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="fl">120</span><span class="op">)</span>
<span class="co">#&gt; (-) waiting for 2fa8770...608, giving up in 119.5 s (\) waiting for</span>
<span class="co">#&gt; 2fa8770...608, giving up in 119.0 s (|) waiting for 2fa8770...608, giving up in</span>
<span class="co">#&gt; 118.5 s (/) waiting for 2fa8770...608, giving up in 117.9 s</span>
<span class="co">#&gt; R version 4.0.3 (2020-10-10)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows Server 2012 R2 x64 (build 9600)</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=English_United Kingdom.1252</span>
<span class="co">#&gt; [2] LC_CTYPE=English_United Kingdom.1252</span>
<span class="co">#&gt; [3] LC_MONETARY=English_United Kingdom.1252</span>
<span class="co">#&gt; [4] LC_NUMERIC=C</span>
<span class="co">#&gt; [5] LC_TIME=English_United Kingdom.1252</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] dplyr_1.0.7 tidyr_1.1.3</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] fansi_0.5.0      digest_0.6.27    utf8_1.2.2       crayon_1.4.1</span>
<span class="co">#&gt;  [5] context_0.3.0    R6_2.5.0         lifecycle_1.0.0  storr_1.2.5</span>
<span class="co">#&gt;  [9] magrittr_2.0.1   pillar_1.6.2     rlang_0.4.11     vctrs_0.3.8</span>
<span class="co">#&gt; [13] generics_0.1.0   ellipsis_0.3.2   glue_1.4.2       purrr_0.3.4</span>
<span class="co">#&gt; [17] compiler_4.0.3   pkgconfig_2.0.3  tidyselect_1.1.1 tibble_3.1.3</span></code></pre></div>
<p>You can use <code>t$result()</code> to get the result straight away (throwing an error if it is not ready) or <code>t$wait(Inf)</code> to wait forever.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; R version 4.0.3 (2020-10-10)</span>
<span class="co">#&gt; Platform: x86_64-w64-mingw32/x64 (64-bit)</span>
<span class="co">#&gt; Running under: Windows Server 2012 R2 x64 (build 9600)</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; Matrix products: default</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; locale:</span>
<span class="co">#&gt; [1] LC_COLLATE=English_United Kingdom.1252</span>
<span class="co">#&gt; [2] LC_CTYPE=English_United Kingdom.1252</span>
<span class="co">#&gt; [3] LC_MONETARY=English_United Kingdom.1252</span>
<span class="co">#&gt; [4] LC_NUMERIC=C</span>
<span class="co">#&gt; [5] LC_TIME=English_United Kingdom.1252</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; attached base packages:</span>
<span class="co">#&gt; [1] stats     graphics  grDevices utils     datasets  methods   base</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; other attached packages:</span>
<span class="co">#&gt; [1] dplyr_1.0.7 tidyr_1.1.3</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; loaded via a namespace (and not attached):</span>
<span class="co">#&gt;  [1] fansi_0.5.0      digest_0.6.27    utf8_1.2.2       crayon_1.4.1</span>
<span class="co">#&gt;  [5] context_0.3.0    R6_2.5.0         lifecycle_1.0.0  storr_1.2.5</span>
<span class="co">#&gt;  [9] magrittr_2.0.1   pillar_1.6.2     rlang_0.4.11     vctrs_0.3.8</span>
<span class="co">#&gt; [13] generics_0.1.0   ellipsis_0.3.2   glue_1.4.2       purrr_0.3.4</span>
<span class="co">#&gt; [17] compiler_4.0.3   pkgconfig_2.0.3  tidyselect_1.1.1 tibble_3.1.3</span></code></pre></div>
</div>
<div id="running-a-single-task" class="section level2">
<h2 class="hasAnchor">
<a href="#running-a-single-task" class="anchor"></a>Running a single task</h2>
<p>This is just using the <code>enqueue</code> function as above. But it also works with functions defined in files passed in as <code>sources</code>; here the function <code>random_walk</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="fu">enqueue</span><span class="op">(</span><span class="fu">random_walk</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="va">t</span><span class="op">$</span><span class="fu">wait</span><span class="op">(</span><span class="fl">120</span><span class="op">)</span>
<span class="co">#&gt; (-) waiting for 66cc979...4f0, giving up in 119.5 s (\) waiting for</span>
<span class="co">#&gt; 66cc979...4f0, giving up in 119.0 s (|) waiting for 66cc979...4f0, giving up in</span>
<span class="co">#&gt; 118.5 s (/) waiting for 66cc979...4f0, giving up in 118.0 s</span>
<span class="va">res</span>
<span class="co">#&gt;  [1] -1.973025 -2.823971 -2.880453 -2.392717 -1.782159 -2.923010 -2.981436</span>
<span class="co">#&gt;  [8] -3.403000 -2.978410 -3.989555</span></code></pre></div>
<p>The <code>t</code> object has a number of other methods you can use:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span>
<span class="co">#&gt; &lt;queuer_task&gt;</span>
<span class="co">#&gt;   Public:</span>
<span class="co">#&gt;     clone: function (deep = FALSE)</span>
<span class="co">#&gt;     context_id: function ()</span>
<span class="co">#&gt;     expr: function (locals = FALSE)</span>
<span class="co">#&gt;     id: 66cc9796e23fa4489a41bb5cfdbef4f0</span>
<span class="co">#&gt;     initialize: function (id, root, check_exists = TRUE)</span>
<span class="co">#&gt;     log: function (parse = TRUE)</span>
<span class="co">#&gt;     result: function (allow_incomplete = FALSE)</span>
<span class="co">#&gt;     root: context_root</span>
<span class="co">#&gt;     status: function ()</span>
<span class="co">#&gt;     times: function (unit_elapsed = "secs")</span>
<span class="co">#&gt;     wait: function (timeout, time_poll = 0.5, progress = NULL)</span></code></pre></div>
<p>Get the result from running a task</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">result</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  [1] -1.973025 -2.823971 -2.880453 -2.392717 -1.782159 -2.923010 -2.981436</span>
<span class="co">#&gt;  [8] -3.403000 -2.978410 -3.989555</span></code></pre></div>
<p>Get the status of the task</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">status</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] "COMPLETE"</span></code></pre></div>
<p>(might also be “PENDING”, “RUNNING” or “ERROR”</p>
<p>Get the original expression:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">expr</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; random_walk(0, 10)</span></code></pre></div>
<p>Find out how long everything took</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">times</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;                            task_id           submitted             started</span>
<span class="co">#&gt; 1 66cc9796e23fa4489a41bb5cfdbef4f0 2021-08-17 14:53:04 2021-08-17 14:53:06</span>
<span class="co">#&gt;              finished  waiting    running      idle</span>
<span class="co">#&gt; 1 2021-08-17 14:53:06 2.134212 0.03126001 0.4418352</span></code></pre></div>
<p>You may see negative numbers for “waiting” as the submitted time is based on your computer and started/finished are based on the cluster.</p>
<p>And get the log from running the task</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t</span><span class="op">$</span><span class="fu">log</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [ hello     ]  2021-08-17 14:53:04</span>
<span class="co">#&gt; [ wd        ]  Q:/didehpc/20210817-145020</span>
<span class="co">#&gt; [ init      ]  2021-08-17 14:53:05.042</span>
<span class="co">#&gt; [ hostname  ]  FI--DIDECLUST26</span>
<span class="co">#&gt; [ process   ]  3800</span>
<span class="co">#&gt; [ version   ]  0.3.0</span>
<span class="co">#&gt; [ open:db   ]  rds</span>
<span class="co">#&gt; [ context   ]  9a70cec48c3108b80503144f9b88cc8d</span>
<span class="co">#&gt; [ library   ]  dplyr, tidyr</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;     Attaching package: 'dplyr'</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;     The following objects are masked from 'package:stats':</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;         filter, lag</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;     The following objects are masked from 'package:base':</span>
<span class="co">#&gt;</span>
<span class="co">#&gt;         intersect, setdiff, setequal, union</span>
<span class="co">#&gt;</span>
<span class="co">#&gt; [ namespace ]</span>
<span class="co">#&gt; [ source    ]  mysources.R</span>
<span class="co">#&gt; [ parallel  ]  running as single core job</span>
<span class="co">#&gt; [ root      ]  Q:\didehpc\20210817-145020\contexts</span>
<span class="co">#&gt; [ context   ]  9a70cec48c3108b80503144f9b88cc8d</span>
<span class="co">#&gt; [ task      ]  66cc9796e23fa4489a41bb5cfdbef4f0</span>
<span class="co">#&gt; [ expr      ]  random_walk(0, 10)</span>
<span class="co">#&gt; [ start     ]  2021-08-17 14:53:06.199</span>
<span class="co">#&gt; [ ok        ]</span>
<span class="co">#&gt; [ end       ]  2021-08-17 14:53:06.261</span>
<span class="co">#&gt;     Warning messages:</span>
<span class="co">#&gt;     1: package 'tidyr' was built under R version 4.0.5</span>
<span class="co">#&gt;     2: package 'dplyr' was built under R version 4.0.5</span></code></pre></div>
<p>There is also a bit of DIDE specific logging that happens before this point; if the job fails inexplicably the answer may be in:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">$</span><span class="fu">dide_log</span><span class="op">(</span><span class="va">t</span><span class="op">)</span>
<span class="co">#&gt;  [1] "generated on host: kea"</span>
<span class="co">#&gt;  [2] "generated on date: 2021-08-17"</span>
<span class="co">#&gt;  [3] "didehpc version: 0.3.6"</span>
<span class="co">#&gt;  [4] "context version: 0.3.0"</span>
<span class="co">#&gt;  [5] "running on: FI--DIDECLUST26"</span>
<span class="co">#&gt;  [6] "mapping Q: -&gt; \\\\fi--san03.dide.ic.ac.uk\\homes\\rfitzjoh"</span>
<span class="co">#&gt;  [7] "The command completed successfully."</span>
<span class="co">#&gt;  [8] ""</span>
<span class="co">#&gt;  [9] "mapping T: -&gt; \\\\fi--didef3.dide.ic.ac.uk\\tmp"</span>
<span class="co">#&gt; [10] "The command completed successfully."</span>
<span class="co">#&gt; [11] ""</span>
<span class="co">#&gt; [12] "Using Rtools at T:\\Rtools\\Rtools40"</span>
<span class="co">#&gt; [13] "working directory: Q:\\didehpc\\20210817-145020"</span>
<span class="co">#&gt; [14] "this is a single task"</span>
<span class="co">#&gt; [15] "logfile: Q:\\didehpc\\20210817-145020\\contexts\\logs\\66cc9796e23fa4489a41bb5cfdbef4f0"</span>
<span class="co">#&gt; [16] ""</span>
<span class="co">#&gt; [17] "Q:\\didehpc\\20210817-145020&gt;Rscript \"Q:\\didehpc\\20210817-145020\\contexts\\bin\\task_run\" \"Q:\\didehpc\\20210817-145020\\contexts\" 66cc9796e23fa4489a41bb5cfdbef4f0  1&gt;\"Q:\\didehpc\\20210817-145020\\contexts\\logs\\66cc9796e23fa4489a41bb5cfdbef4f0\" 2&gt;&amp;1"</span>
<span class="co">#&gt; [18] "Removing mapping Q:"</span>
<span class="co">#&gt; [19] "Q: was deleted successfully."</span>
<span class="co">#&gt; [20] ""</span>
<span class="co">#&gt; [21] "Removing mapping T:"</span>
<span class="co">#&gt; [22] "T: was deleted successfully."</span>
<span class="co">#&gt; [23] ""</span>
<span class="co">#&gt; [24] "Quitting"</span></code></pre></div>
<p>Want more information? See <code><a href="../articles/didehpc.html">vignette("didehpc")</a></code> for more details.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rich FitzJohn, Wes Hinsley.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
